#!/bin/bash

set -eu

source=$1
dir=$(dirname $source)
filename=$(basename $source)
target=$(basename $source .mustache).html

temp=$(tempfile)
chmod 644 $temp

cleanup () {
  local ev=$?
  rm -f -- $temp
  exit $ev
}
trap cleanup EXIT

cd $dir
mustache /dev/null $filename > $temp
mv -f -- $temp $target
rm -f -- $filename
